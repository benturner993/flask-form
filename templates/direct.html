{% extends "base.html" %}

{% block content %}

<div style="text-align: center; padding: 75px 0; background-color: #f1efeb; color: black; position: relative; margin-top: -20px; width: 100vw; margin-left: calc(50% - 50vw); margin-right: calc(50% - 50vw);">
    <h3 style="margin: 0; padding: 0; width: 100%;">Welcome to Reward and Retain</h3>
    <h1 style="margin: 0; padding: 0; width: 100%;">Your Hub for Direct Reactive Retention</h1>
</div>

<div style="width: 100%; height: 50vh; display: flex; justify-content: center; align-items: center;">
    <div style="max-width: 90%; width: 100%; display: flex; justify-content: space-between;">
        <div style="width: 70vw;">
            <form id="user-form" style="margin-top: 10px; margin-bottom: 10px; display: grid; grid-template-columns: repeat(2, 45%); gap: 5%; position: relative;">
                <input type="text" id="registration-number" name="registration-number" placeholder="Registration Number" class="input-field" style="font-size: 0.8em;">
                <input type="date" id="renewal-date" name="renewal-date" placeholder="Renewal Date" class="input-field" style="font-size: 0.8em;">
                <input type="number" id="annual-subs" name="annual-subs" placeholder="Total Annual Subs incl IPT" class="input-field" style="font-size: 0.8em;">
                <select id="color-segment" name="color-segment" class="input-field" style="font-size: 0.8em;">
                    <option value="" disabled selected hidden>Colour Segment</option>
                    <option value="Red">Red</option>
                    <option value="Green">Green</option>
                    <option value="Amber">Amber</option>
                    <option value="New">New</option>
                    <option value="Grey">Grey</option>
                    <option value="Blue">Blue</option>
                    <option value="Purple">Purple</option>
                    <option value="Missing">Missing</option>
                </select>
                <select id="claims-paid" name="claims-paid" class="input-field" style="font-size: 0.8em;">
                    <option value="" disabled selected hidden>Claims Paid in the Last Year</option>
                    <option value="Less Than £500">Less Than £500</option>
                    <option value="Between £500 and £1000">Between £500 and £1000</option>
                    <option value="More Than £1000">More Than £1000</option>
                </select>
                <select id="payment-frequency" name="payment-frequency" class="input-field" style="font-size: 0.8em;">
                    <option value="" disabled selected hidden>Payment Frequency</option>
                    <option value="Monthly">Monthly</option>
                    <option value="Annually">Annually</option>
                </select>
                <select id="months-arrears" name="months-arrears" class="input-field" style="font-size: 0.8em;">
                    <option value="" disabled selected hidden>Months in Arrears</option>
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                </select>
                <select id="months-free-last" name="months-free-last" class="input-field" style="font-size: 0.8em;">
                    <option value="" disabled selected hidden>Months Free Last Year</option>
                    <option value="No">No</option>
                    <option value="Yes">Yes</option>
                </select>
                <select id="months-free-this" name="months-free-this" class="input-field" style="font-size: 0.8em;">
                    <option value="" disabled selected hidden>Months Free This Year</option>
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                </select>
                <select id="offer-accepted" name="offer-accepted" class="input-field" style="font-size: 0.8em;">
                    <option value="" disabled selected hidden>Offer was Accepted?</option>
                    <option value="Not Eligible for Offer">Not Eligible for Offer</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                    <option value="Maybe">Maybe</option>
                    <option value="Yes - With STM Override">Yes - With STM Override</option>
                    <option value="Maybe - With STM Override">Maybe - With STM Override</option>
                </select>
            </form>
        </div>
        <div id="grey-box" style="background-color: #f1efeb; padding: 20px; width: 25vw; display: flex; flex-direction: column; justify-content: flex-start; border-radius: 20px; border: 2px solid transparent;">
            <p>Offer: <span id="annual-subs-display" style="font-weight: bold;"></span></p>
            <p>Value: <span id="value" style="font-weight: bold;"></span></p>
            <p>Total Payable: <span id="total_payable" style="font-weight: bold;"></span></p>
        </div>
    </div>
</div>
<div style="display: flex; justify-content: flex-end; margin-right: 10vh;">
    <button onclick="displayAnnualSubs()" style="margin-bottom: 5px">Calculate</button>
    <button type="button" onclick="submitForm()" style="margin-bottom: 5px; margin-left: 10px;">Submit</button>
    <button type="button" onclick="clearForm()" style="margin-bottom: 5px; margin-left: 10px;">Clear</button>
</div>

<script>
    const formInputs = document.querySelectorAll('.input-field');
    const annualSubsDisplay = document.getElementById('annual-subs-display');
    const greyBox = document.getElementById('grey-box');

    function submitForm() {
        const formData = {};
        formInputs.forEach(input => {
            formData[input.name] = input.value.trim();
        });

        fetch('/submit', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message);
            location.reload();  // Refresh the page to clear the form
        })
        .catch(error => console.error('Error:', error));
    }

    function displayAnnualSubs() {
        const formData = {};
        formInputs.forEach(input => {
            formData[input.name] = input.value.trim();
        });
        formData.url = window.location.href; // Get the current URL

        fetch('/multiply', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        })
        .then(response => response.json())
        .then(data => {
            if (data.result !== undefined) {
                annualSubsDisplay.textContent = data.result;
                document.getElementById('total_payable').textContent = data.total_payable;
                document.getElementById('value').textContent = data.value;

                // Set the border color based on offer_bin
                if (data.eligible === 1) {
                    greyBox.style.borderColor = 'green';
                } else {
                    greyBox.style.borderColor = 'red';
                }
            } else {
                annualSubsDisplay.textContent = 'Error: ' + data.error;
            }
        })
        .catch(error => console.error('Error:', error));
    }

    function clearForm() {
        location.reload();  // Refresh the page to clear the form
    }

    window.onload = function() {
        const userForm = document.getElementById('user-form');
        greyBox.style.height = `${userForm.offsetHeight}px`;
    };
</script>

<style>
    /* Import Montserrat font from Google Fonts */
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');

    /* Apply Montserrat font to input fields and select dropdowns */
    .input-field {
        padding: 10px;
        width: 100%;
        box-sizing: border-box;
        height: 40px;
        font-size: 0.8em;
        color: #777;
        font-family: 'Montserrat', sans-serif; /* Apply Montserrat font */
    }

    select.input-field {
        width: 100%;
        height: 40px;
        font-size: 0.8em;
        color: #777;
        font-family: 'Montserrat', sans-serif; /* Apply Montserrat font */
    }

    .input-field:not(:last-child) {
        margin-bottom: 10px;
    }

    button {
        padding: 10px 20px;
        background-color: #0d1846;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.8em;
        font-family: 'Montserrat', sans-serif; /* Apply Montserrat font */
    }
</style>
{% endblock %}
